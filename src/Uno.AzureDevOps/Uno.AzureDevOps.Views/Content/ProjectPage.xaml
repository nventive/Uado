<Page x:Class="Uno.AzureDevOps.Views.Content.ProjectPage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	  xmlns:xamarin="http://nventive.com/xamarin"
	  xmlns:toolkit="using:Uno.UI.Toolkit"
	  mc:Ignorable="xamarin">

	<Page.Resources>

		<!-- Team ComboBoxItem Style -->
		<DataTemplate x:Key="TeamComboBoxItemTemplate">
			<Grid Background="{StaticResource Color02Brush}"
				  BorderBrush="{StaticResource Color07Brush}"
				  BorderThickness="0,0,0,1"
				  Height="{StaticResource SmallComboBoxHeight}">

				<!-- Name -->
				<TextBlock Text="{Binding Name}"
						   Style="{StaticResource Typo03}"
						   VerticalAlignment="Center"
						   Margin="16,0" />
			</Grid>
		</DataTemplate>

		<!-- Sprint ComboBoxItem Style -->
		<DataTemplate x:Key="SprintComboBoxItemTemplate">
			<Grid Background="{StaticResource Color02Brush}"
				  HorizontalAlignment="Stretch"
				  BorderBrush="{StaticResource Color07Brush}"
				  BorderThickness="0,0,0,1"
				  win:Margin="0,0,0,1"
				  Padding="16,8">
				<StackPanel VerticalAlignment="Center">
					<!-- Name -->
					<TextBlock Text="{Binding Name}"
							   Style="{StaticResource Typo03}" />

					<!-- TimeSpan -->
					<StackPanel Orientation="Horizontal"
								Visibility="{Binding Text, ElementName=StartDateTxt, Converter={StaticResource EmptyStringToCollapsed}, FallbackValue=Collapsed}">

						<TextBlock x:Name="StartDateTxt"
								   Text="{Binding Attributes.StartDate, Converter={StaticResource DateToISODate}}"
								   Style="{StaticResource Typo12}" />
						<TextBlock Text="-"
								   Style="{StaticResource Typo12}"
								   Margin="3,0" />
						<TextBlock Text="{Binding Attributes.FinishDate, Converter={StaticResource DateToISODate}}"
								   Style="{StaticResource Typo12}" />
					</StackPanel>
				</StackPanel>
			</Grid>
		</DataTemplate>

		<DataTemplate x:Key="WorkItemTemplate">
			<StackPanel>
				<Grid Height="40">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>

					<!-- Icon -->
					<Path Data="{Binding Item.WorkItemType, Converter={StaticResource WorkItemTypeToIconPath}}"
						  Fill="{Binding Item.WorkItemType, Converter={StaticResource WorkItemTypeToIconColor}}"
						  Height="24"
						  Width="17"
						  VerticalAlignment="Center"
						  Margin="18,8,0,0" />

					<!-- Title -->
					<TextBlock Text="{Binding Item.Title}"
							   Style="{StaticResource Typo05}"
							   MaxLines="1"
							   VerticalAlignment="Center"
							   TextWrapping="NoWrap"
							   Margin="10,0"
							   Grid.Column="1">
					</TextBlock>
				</Grid>

				<!-- Separator -->
				<Rectangle Height="1"
						   Fill="{StaticResource Color07Brush}"
						   Margin="16,1,0,0" />
			</StackPanel>
		</DataTemplate>
	</Page.Resources>

	<Grid Background="{StaticResource Color02Brush}"
		  toolkit:VisibleBoundsPadding.PaddingMask="Left,Right">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup>
				<VisualState x:Name="wide">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="1024" />
					</VisualState.StateTriggers>

					<VisualState.Setters>
						<Setter Target="NavigationTabRoot.MaxWidth"
								Value="600" />
						<Setter Target="LargeViewNavigation.Visibility"
								Value="Visible" />
						<Setter Target="ProfileButton.Visibility"
								Value="Collapsed" />
						<Setter Target="ReloadButton_1.MaxWidth"
								Value="300" />
						<Setter Target="ReloadButton_2.MaxWidth"
								Value="300" />
						<Setter Target="SummarySideCollum.Width"
								Value="2*" />
						<Setter Target="SummarySideData.Grid.Column"
								Value="1" />
						<Setter Target="SummarySideData.Grid.Row"
								Value="0" />
						<Setter Target="SummarySideData.Margin"
								Value="16,0,0,0" />
					</VisualState.Setters>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>

		<!-- CommandBar -->
		<CommandBar Content="{Binding SelectedProjectName}">
			<CommandBar.PrimaryCommands>

				<!-- Profile Button -->
				<AppBarButton x:Name="ProfileButton"
							  Style="{StaticResource UserProfileButtonStyle}">
					<AppBarButton.Flyout>
						<MenuFlyout>

							<!-- Organizations Button -->
							<MenuFlyoutItem Text="Organization"
											Command="{Binding NavigateToOrganizations}" />

							<!-- Projects Button -->
							<MenuFlyoutItem Text="Projects"
											Command="{Binding NavigateToProjects}" />

							<!-- Profile Button -->
							<MenuFlyoutItem Text="Profile"
											Command="{Binding ToProfilePage}" />
						</MenuFlyout>
					</AppBarButton.Flyout>
				</AppBarButton>
			</CommandBar.PrimaryCommands>
		</CommandBar>

		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>

			<Grid x:Name="LargeViewNavigation"
				  Background="{StaticResource Color06Brush}"
				  Visibility="Collapsed"
				  Width="300">

				<StackPanel VerticalAlignment="Top">

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />

					<!-- Organization Button -->
					<Button Content="Organization"
							Command="{Binding NavigateToOrganizations}"
							Style="{StaticResource NavigationButtonStyle}" />

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />

					<!-- Project Button -->
					<Button Content="Project"
							Command="{Binding NavigateToProjects}"
							Style="{StaticResource NavigationButtonStyle}" />

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />
				</StackPanel>

				<StackPanel VerticalAlignment="Bottom"
							Margin="0,0,0,42">

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />

					<!-- Profile Button -->
					<Button Content="Profile"
							Command="{Binding ToProfilePage}"
							Style="{StaticResource NavigationButtonStyle}" />

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />

					<!-- Log Out Button -->
					<Button Content="Log Out"
							Command="{Binding Logout}"
							Style="{StaticResource NavigationButtonStyle}" />

					<!-- Separation -->
					<Rectangle Fill="{StaticResource Color02Brush}"
							   Height="1" />
				</StackPanel>
			</Grid>

			<Grid Grid.Column="1">

				<!-- Loading State -->
				<Grid Visibility="{Binding LoadingSuccess, Converter={StaticResource TrueToCollapsed}, FallbackValue=Collapsed, TargetNullValue=Collapsed}">

					<StackPanel VerticalAlignment="Center"
								HorizontalAlignment="Center">

						<!-- Progress Ring -->
						<ProgressRing IsActive="True"
									  Foreground="{StaticResource Color03Brush}"
									  Height="20"
									  Width="20"
									  HorizontalAlignment="Center"
									  VerticalAlignment="Center"
									  Margin="0,12" />

						<!-- Verifying Message -->
						<TextBlock Text="Loading..."
								   Style="{StaticResource Typo08}" />
					</StackPanel>
				</Grid>

				<!-- Error State -->
				<Grid Visibility="{Binding Teams.IsFaulted, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}">

					<!-- Message -->
					<TextBlock Text="{Binding Teams.IsInternetFaulted, Converter={StaticResource BoolToCustomString}}"
							   Style="{StaticResource Typo10}"
							   HorizontalAlignment="Center"
							   VerticalAlignment="Center"
							   TextAlignment="Center"
							   Margin="50,0,50,48" />

					<!-- Reload button -->
					<Button x:Name="ReloadButton_1"
							Content="Reload"
							Command="{Binding ReloadPage}"
							Style="{StaticResource ReloadButtonStyle}"
							VerticalAlignment="Bottom"
							Margin="16,22" />
				</Grid>

				<!-- Content -->
				<Grid x:Name="RootLayout"
					  Visibility="{Binding LoadingSuccess, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed, UpdateSourceTrigger=PropertyChanged}"
					  Background="{StaticResource Color02Brush}">
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<!-- Teams ComboBox -->
					<!-- The combobox is disabled if only one item exists in its list -->
					<ComboBox x:Name="TeamsComboBox"
							  ItemsSource="{Binding Teams.Result}"
							  SelectedItem="{Binding SelectedTeam, Mode=TwoWay}"
							  ItemTemplate="{StaticResource TeamComboBoxItemTemplate}"
							  Height="{StaticResource SmallComboBoxHeight}"
							  IsEnabled="{Binding Teams.Result, Converter={StaticResource EnumerableHasMinimumToTrue}}"
							  xamarin:DeferLoadStrategy="Lazy" />

					<!-- Navigation tabs -->
					<Grid BorderBrush="{StaticResource Color07Brush}"
						  BorderThickness="0,0,0,1"
						  Grid.Row="1">
						<Grid x:Name="NavigationTabRoot">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="*" />
							</Grid.ColumnDefinitions>

							<!-- Summary View Tab -->
							<RadioButton x:Name="SummaryBtn"
										 GroupName="ViewTabsThin"
										 Content="Summary"
										 IsChecked="{Binding Path=CurrentView, Mode=TwoWay, Converter={StaticResource ProjectViewToIsCheckedConverter}, ConverterParameter=Summary}"
										 Grid.Column="0" />

							<!-- Srpint View Tab -->
							<RadioButton x:Name="SprintBtn"
										 GroupName="ViewTabsThin"
										 Content="Sprint"
										 IsChecked="{Binding Path=CurrentView, Mode=TwoWay, Converter={StaticResource ProjectViewToIsCheckedConverter}, ConverterParameter=Sprint}"
										 Grid.Column="1" />

							<!-- Members View Tab -->
							<RadioButton x:Name="MembersBtn"
										 GroupName="ViewTabsThin"
										 Content="Members"
										 IsChecked="{Binding Path=CurrentView, Mode=TwoWay, Converter={StaticResource ProjectViewToIsCheckedConverter}, ConverterParameter=Members}"
										 Grid.Column="2" />
						</Grid>
					</Grid>

					<!-- Summary -->
					<Grid Visibility="{Binding IsChecked, ElementName=SummaryBtn, Converter={StaticResource TrueToVisible}}"
						  Grid.Row="2">
						<ScrollViewer>
							<Grid Background="{StaticResource Color07Brush}"
								  Padding="16,16,16,16">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="3*" />
									<ColumnDefinition x:Name="SummarySideCollum"
													  Width="0" />
								</Grid.ColumnDefinitions>

								<Grid.RowDefinitions>
									<RowDefinition Height="*" />
									<RowDefinition Height="Auto" />
								</Grid.RowDefinitions>

								<Grid Background="{StaticResource Color02Brush}"
									  MinHeight="500"
									  CornerRadius="5"
									  Margin="0,0,0,0"
									  Grid.Column="0">

									<TextBlock Text="A"
											   Foreground="Black"
											   FontSize="80"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Center" />
								</Grid>

								<Grid x:Name="SummarySideData"
									  Margin="0,16,0,0"
									  Grid.Column="0"
									  Grid.Row="1">
									<Grid.RowDefinitions>
										<RowDefinition Height="*" />
										<RowDefinition Height="*" />
									</Grid.RowDefinitions>

									<Grid Background="{StaticResource Color02Brush}"
										  MinHeight="200"
										  CornerRadius="5"
										  Margin="0,0,0,8"
										  Grid.Row="0">

										<TextBlock Text="B"
												   Foreground="Black"
												   FontSize="80"
												   VerticalAlignment="Center"
												   HorizontalAlignment="Center" />
									</Grid>

									<Grid Background="{StaticResource Color02Brush}"
										  MinHeight="200"
										  CornerRadius="5"
										  Margin="0,8,0,0"
										  Grid.Row="1">

										<TextBlock Text="C"
												   Foreground="Black"
												   FontSize="80"
												   VerticalAlignment="Center"
												   HorizontalAlignment="Center" />
									</Grid>
								</Grid>
							</Grid>
						</ScrollViewer>
					</Grid>

					<!-- Sprint -->
					<Grid Visibility="{Binding IsChecked,ElementName=SprintBtn, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}"
						  Grid.Row="2">
						<Grid.RowDefinitions>
							<RowDefinition Height="64" />
							<RowDefinition Height="*" />
						</Grid.RowDefinitions>

						<!-- Iterations ComboBox -->
						<!-- The combobox is disabled if only one item exists in its list -->
						<ComboBox x:Name="IterationsComboBox"
								  Visibility="{Binding Iterations.IsSuccess, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
								  ItemsSource="{Binding Iterations.Result}"
								  IsEnabled="{Binding Iterations.Result, Converter={StaticResource EnumerableHasMinimumToTrue}}"
								  SelectedItem="{Binding SelectedIteration, Mode=TwoWay}"
								  ItemTemplate="{StaticResource SprintComboBoxItemTemplate}"
								  Height="{StaticResource LargeComboBoxHeight}"
								  xamarin:DeferLoadStrategy="Lazy" />

						<!-- No Sprint State -->
						<Grid Visibility="{Binding Iterations.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed }">
							<StackPanel VerticalAlignment="Center"
										Margin="16,0">

								<!-- Name -->
								<TextBlock Text="No sprint available"
										   Style="{StaticResource Typo03}" />

								<!-- TimeSpan -->
								<TextBlock Text="N.A."
										   Style="{StaticResource Typo12}" />
							</StackPanel>
						</Grid>

						<!-- Loading State -->
						<Grid Visibility="{Binding Iterations.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}">

							<!-- Progress Ring -->
							<ProgressRing IsActive="True"
										  Foreground="{StaticResource Color03Brush}"
										  Height="20"
										  Width="20"
										  HorizontalAlignment="Center"
										  VerticalAlignment="Center"
										  Margin="0,12" />
						</Grid>

						<!-- Work Items List -->
						<ListView ItemsSource="{Binding IterationWorkItems.Result}"
								  ItemTemplate="{StaticResource WorkItemTemplate}"
								  IsItemClickEnabled="True"
								  ItemClick="ListView_ItemClick"
								  Padding="0,0,0,80"
								  Grid.Row="1" />

						<!-- Empty List Message -->
						<TextBlock Visibility="{Binding IterationWorkItems.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed}"
								   Text="No work items in this iteration"
								   Style="{StaticResource Typo15}"
								   Margin="16,12"
								   Grid.Row="1" />

						<!-- Error state for work items list -->
						<Grid Visibility="{Binding IterationWorkItems.IsFaulted, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}"
							  Background="{StaticResource Color07Brush}"
							  Grid.Row="1">

							<!-- Message -->
							<TextBlock Text="{Binding IterationWorkItems.IsInternetFaulted, Converter={StaticResource BoolToCustomString}}"
									   Style="{StaticResource Typo10}"
									   HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   TextAlignment="Center"
									   Margin="25,0,25,24" />

							<!-- Reload button -->
							<Button x:Name="ReloadButton_2"
									Content="Reload"
									Command="{Binding ReloadPage}"
									Style="{StaticResource ReloadButtonStyle}"
									VerticalAlignment="Bottom"
									Margin="16,22" />
						</Grid>

						<!-- Loading State -->
						<Grid Visibility="{Binding IterationWorkItems.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}"
							  Grid.Row="1">

							<StackPanel VerticalAlignment="Center"
										HorizontalAlignment="Center">

								<!-- Progress Ring -->
								<ProgressRing IsActive="True"
											  Foreground="{StaticResource Color03Brush}"
											  HorizontalAlignment="Center"
											  VerticalAlignment="Center"
											  Height="20"
											  Width="20"
											  Margin="0,12" />

								<!-- Verifying Message -->
								<TextBlock Text="Loading..."
										   Style="{StaticResource Typo08}" />
							</StackPanel>
						</Grid>
					</Grid>

					<!-- Members -->
					<Grid Visibility="{Binding IsChecked, ElementName=MembersBtn, Converter={StaticResource TrueToVisible}}"
						  Grid.Row="2">

						<!-- Project Members -->
						<ListView ItemsSource="{Binding TeamMembers.Result}"
								  IsItemClickEnabled="False"
								  SelectionMode="None">
							<ListView.ItemTemplate>
								<DataTemplate>
									<Grid>
										<StackPanel>
											<Grid Background="Transparent"
												  Height="56">
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="Auto" />
													<ColumnDefinition Width="*" />
												</Grid.ColumnDefinitions>

												<!-- Project Member Image -->
												<Grid Background="{StaticResource Color07Brush}"
													  VerticalAlignment="Center"
													  CornerRadius="16"
													  Height="32"
													  Width="32"
													  Margin="16,0,0,0"
													  Grid.Column="0">

													<!-- Initials -->
													<TextBlock Text="{Binding Identity.DisplayName, Converter={StaticResource MemberInitials}}"
															   Style="{StaticResource MemberInitialsTextBlock}" />

													<!-- Profile image -->
													<Grid Height="32"
														  Width="32"
														  CornerRadius="16">
														<Grid.Background>
															<ImageBrush ImageSource="{Binding Identity.Links.Links[avatar].Href}" />
														</Grid.Background>
													</Grid>
												</Grid>

												<!-- Project Member Name -->
												<TextBlock Text="{Binding Identity.DisplayName}"
														   Style="{StaticResource Typo08}"
														   VerticalAlignment="Center"
														   Margin="10,0,0,0"
														   MaxLines="1"
														   Grid.Column="1" />
											</Grid>

											<!-- Separator -->
											<Rectangle Height="1"
													   Fill="{StaticResource Color07Brush}"
													   Margin="16,1,0,0" />
										</StackPanel>
									</Grid>
								</DataTemplate>
							</ListView.ItemTemplate>
						</ListView>

						<!-- Empty List Message -->
						<TextBlock Text="No members in this project"
								   Visibility="{Binding TeamMembers.Result, Converter={StaticResource EnumerableHasAnyToCollapsed}, FallbackValue=Collapsed}"
								   Style="{StaticResource Typo15}"
								   Margin="16,12" />


						<!-- Error state for member listview -->
						<Grid Visibility="{Binding TeamMembers.IsFaulted, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed}"
							  Background="{StaticResource Color07Brush}">

							<!-- Message -->
							<TextBlock Text="{Binding TeamMembers.IsInternetFaulted, Converter={StaticResource BoolToCustomString}}"
									   Style="{StaticResource Typo10}"
									   HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   TextAlignment="Center"
									   Margin="50,0,50,48" />
						</Grid>

						<!-- Loading State -->
						<Grid Visibility="{Binding TeamMembers.IsExecuting, Converter={StaticResource TrueToVisible}, FallbackValue=Collapsed, TargetNullValue=Collapsed}">

							<StackPanel VerticalAlignment="Center"
										HorizontalAlignment="Center">

								<!-- Progress Ring -->
								<ProgressRing IsActive="True"
											  Foreground="{StaticResource Color03Brush}"
											  HorizontalAlignment="Center"
											  VerticalAlignment="Center"
											  Height="20"
											  Width="20"
											  Margin="0,12" />

								<!-- Verifying Message -->
								<TextBlock Text="Loading..."
										   Style="{StaticResource Typo08}" />
							</StackPanel>
						</Grid>
					</Grid>
				</Grid>
			</Grid>
		</Grid>

		<Grid x:Name="LargeScreenOverLay"
			  Grid.Row="1">

			<!-- ComboBox Popup BG 1 -->
			<Grid Visibility="{Binding IsDropDownOpen, ElementName=TeamsComboBox, Converter={StaticResource TrueToVisible}}"
				  Background="Black"
				  Opacity="0.6"
				  Grid.RowSpan="2" />

			<!-- ComboBox Popup BG 2 -->
			<Grid Visibility="{Binding IsDropDownOpen, ElementName=IterationsComboBox, Converter={StaticResource TrueToVisible}}"
				  Background="Black"
				  Opacity="0.6"
				  Grid.RowSpan="2" />
		</Grid>
	</Grid>
</Page>
